<!DOCTYPE html>
<html lang="es">
	<head>
		<title>API Youtube Ejemplos</title>
		<script>
			function peticion(){	
				totalSegundos = 0;
				var idLista = "";
				var idUrlLista = document.getElementById("idUrlLista").value;
				 if(idUrlLista.lastIndexOf("=") === -1){
				 	idLista = idUrlLista;
				 }
				 else{
				 	idLista = idUrlLista.substring(idUrlLista.lastIndexOf("=")+1);
				 }
				 	
				var requestOptions = {
					part : "contentDetails",
					playlistId: idLista,
					maxResults: 50
				};

				var request = gapi.client.youtube.playlistItems.list(requestOptions);
				request.then(function(response){
					var totalVideos = response.result.pageInfo.totalResults;
					var playlistItems = response.result.items;

					var caja = document.getElementById("informacion");
					caja.innerHTML = "Cantidad de Videos: "+totalVideos+"<br><br>"; 

					var listaTotal = "";
					for(var i = 0, t = playlistItems.length; i<t; i++){
						var videoId = playlistItems[i].contentDetails.videoId;
						peticionVideo(videoId);
					}

					function peticionVideo(videoId){
						var requestOptionsVideos = {
							part : "contentDetails,snippet",
							id : videoId,
							fields : "items(contentDetails/duration,snippet/title)" 
						}
						var requestVideo = gapi.client.youtube.videos.list(requestOptionsVideos);
						
						requestVideo.then(function(response){
							var tiempoOrigen = response.result.items[0].contentDetails.duration;
							var tiempoConFormato = formatoTiempo(tiempoOrigen);
							caja.innerHTML += response.result.items[0].snippet.title+"<br>"+tiempoConFormato+"<br>";
							
						});
					}

					function formatoTiempo(tiempoOrigen){
						var h = "00";
						var m = "00";
						var s = "00";

						if(tiempoOrigen.match(/[0-9][0-9]H|[0-9]H/)){
							h =  tiempoOrigen.match(/[0-9][0-9]H|[0-9]H/)[0].match(/[0-9][0-9]|[0-9]/);
						}
						if(tiempoOrigen.match(/[0-9][0-9]M|[0-9]M/)){
							m =  tiempoOrigen.match(/[0-9][0-9]M|[0-9]M/)[0].match(/[0-9][0-9]|[0-9]/);
						}
						if(tiempoOrigen.match(/[0-9][0-9]S|[0-9]S/)){
							s =  tiempoOrigen.match(/[0-9][0-9]S|[0-9]S/)[0].match(/[0-9][0-9]|[0-9]/);
						}
						var tiempo = h+":"+m+":"+s;
						
						var valorHora = parseInt(h);
						var valorMinutos = parseInt(m);
						var valorSegundos = parseInt(s);	

						calculoTotal(valorHora, valorMinutos, valorSegundos);
						return tiempo;
					}

					function calculoTotal(valorHora, valorMinutos, valorSegundos){
						totalSegundos += valorHora * 3600 + valorMinutos * 60 + valorSegundos;
						var calculoHora = Math.floor(totalSegundos / 3600);
						var calculoMinutos = (totalSegundos / 3600 - calculoHora) * 60;
						var calculoSegundos = (calculoMinutos - Math.floor(calculoMinutos)) * 60;

						if(calculoHora<10){ calculoHora = "0"+calculoHora; }

						if(Math.floor(calculoMinutos)<10){ 
							calculoMinutos = "0"+Math.floor(calculoMinutos); 
						} else{
							calculoMinutos = Math.floor(calculoMinutos);
						}

						if(calculoSegundos<10){ 
							calculoSegundos = "0"+Math.floor(calculoSegundos); 
						} else{
							calculoSegundos = Math.floor(calculoSegundos); 
						}
						
						
						var duracionTotalCaja = document.getElementById("duracionTotal");
						duracionTotal.innerHTML = "<br>Duracion Total de la Lista de Reproduccion: "+calculoHora+" : "+calculoMinutos+" : "+calculoSegundos;
					}
					
				});

			}

			function init(){
				gapi.client.setApiKey("AIzaSyARaWBizwChYj0ROHcQHaj23de5d2wj9NQ");
				gapi.client.load("youtube", "v3").then(peticion);
			}

			function iniciar(){
				var boton = document.getElementById("boton");
				boton.addEventListener("click", init, false);
			}

			window.addEventListener("load", iniciar, false);
		</script>
		<script src="https://apis.google.com/js/client.js"></script>
	</head>
	<body>
		<form>
			<input type="text" placeholder="introduce el id o url de la lista" autofocus id="idUrlLista" size="50">
			<input type="button" id="boton" value="Dame">
		</form>
		<div id="informacion">
		</div> 
		<div id="duracionTotal"></div>		
	</body>
</html>